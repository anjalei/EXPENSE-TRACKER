<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PROJECT</title>
    <style>
      /* === Your existing Buy Premium button === */
      #checkout-button {
        position: fixed;
        top: 20px;
        right: 20px;
        background-color: gold;
        color: black;
        padding: 10px 20px;
        border: none;
        border-radius: 8px;
        font-weight: bold;
        cursor: pointer;
        box-shadow: 0 4px 6px rgba(46, 43, 24, 0.2);
        z-index: 999;
      }
      #checkout-button:hover {
        background-color: #ffd700;
      }

      /* === New Global Styles === */
      :root {
        --primary: #2c7a7b;
        --light: #e6fffa;
        --danger: #e53e3e;
        --muted: #718096;
      }
      body {
        font-family: sans-serif;
        margin: 0;
        padding-bottom: 4rem; /* space for download button */
      }
      h1, h2 {
        text-align: center;
        color: var(--primary);
        margin: 1rem 0;
      }
      .filter-bar {
        display: flex;
        justify-content: center;
        margin: 1rem 0;
      }
      .filter-bar select {
        padding: 0.5rem;
        font-size: 1rem;
        border: 1px solid var(--muted);
        border-radius: 4px;
      }

      table {
        width: 90%;
        max-width: 600px;
        margin: 0 auto 1.5rem;
        border-collapse: collapse;
        font-size: 0.9rem;
      }
      th, td {
        padding: 0.5rem;
        border: 1px solid #cbd5e0;
      }
      thead {
        background: var(--primary);
        color: #fff;
      }
      tbody tr:nth-child(odd) {
        background: var(--light);
      }
      .text-center { text-align: center; }
      .totals-row {
        font-weight: bold;
        background: #f7fafc;
      }
      .text-success { color: green; }
      .text-danger { color: var(--danger); }

      /* Floating Download Button */
      #downloadBtn {
        position: fixed;
        bottom: 1.5rem;
        right: 1rem;
        width: 56px;
        height: 56px;
        border: none;
        border-radius: 50%;
        background: var(--primary);
        color: #fff;
        font-size: 1.5rem;
        box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        cursor: pointer;
        z-index: 999;
      }
      #downloadBtn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }
    </style>
  </head>

  <body>
    <!-- Premium message -->
    <h2 id="premium-msg"></h2>

    <div class="container">
      <!-- Your expense form -->
      <form id="forms" class="forms">
        <div>
          <label for="expenseamount">Expense Amount</label>
          <input type="number" step="0.01" min="0" id="expenseamount" name="amount" required />

          <label for="description">Description</label>
          <input type="text" id="description" name="Category" />

          <label for="category">Choose a Category</label>
          <select id="category" name="lists">
            <option value="movie">Movie</option>
            <option value="fuel">Fuel</option>
            <option value="food">Food</option>
            <option value="health">Health</option>
            <option value="electricity">Electricity</option>
            <option value="shopping">Shopping</option>
          </select>
          <button type="submit">Add</button>
        </div>
      </form>

      <!-- Existing expense list -->
      <ul id="expenselist"></ul>

      <!-- Buy Premium -->
      <button id="checkout-button">Buy Premium</button>
    </div>

    <!-- Total expenses -->
    <h3 id="totalExpenses" style="text-align:center;">Total Expenses: â‚¹0</h3>

    <!-- Leaderboard -->
    <button id="leaderboard-btn" style="margin: 20px auto; display: block;">Show Leaderboard</button>
    <div id="leaderboard" style="margin-top: 30px; text-align: center;"></div>


    <!-- === NEW: Filter Bar & Tables (Premium Only) === -->
    <div id="premium-section" style="display:none;">
      <h1>Day to Day Expenses</h1>
      <div class="filter-bar">
        <select id="filterType" onchange="filterTransactions()">
          <option value="all">All</option>
          <option value="daily">Today</option>
          <option value="weekly">This Week</option>
          <option value="monthly">This Month</option>
        </select>
      </div>

      <!-- Day-to-day -->
      <table>
        <thead>
          <tr>
            <th>Date</th><th>Description</th><th>Category</th>
            <th class="text-center">Income</th><th class="text-center">Expense</th>
          </tr>
        </thead>
        <tbody id="dayTable">
          <tr><td colspan="5" class="text-center">No data</td></tr>
        </tbody>
        <tfoot>
          <tr class="totals-row">
            <td colspan="3">Total</td>
            <td class="text-success">â‚¹0.00</td>
            <td class="text-danger">â‚¹0.00</td>
          </tr>
        </tfoot>
      </table>

      <!-- Yearly -->
      <h2>Yearly Report</h2>
      <table>
        <thead>
          <tr>
            <th>Month</th><th class="text-center">Income</th>
            <th class="text-center">Expense</th><th class="text-center">Savings</th>
          </tr>
        </thead>
        <tbody id="yearlyReport">
          <tr><td colspan="4" class="text-center">No data</td></tr>
        </tbody>
      </table>

      <!-- Notes -->
      <h2>Notes Report</h2>
      <table>
        <thead>
          <tr><th>Date</th><th>Notes</th></tr>
        </thead>
        <tbody id="notesTable">
          <tr><td colspan="2" class="text-center">No notes</td></tr>
        </tbody>
      </table>
    </div>

    <!-- Download button -->
    <button id="downloadBtn" onclick="downloadExpenses()">â¬‡</button>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://sdk.cashfree.com/js/v3/cashfree.js"></script>
    <script src="expense.js"></script>
    <script src="premium.js"></script>

    <script>
      

      window.addEventListener('load', () => {
        // Show/hide premium section & download button
        if (isPremiumUser) {
          document.getElementById('premium-section').style.display = 'block';
          document.getElementById('downloadBtn').disabled = false;
          document.getElementById('premium-msg').innerText = 'ðŸŒŸ Premium Features Unlocked!';
        } else {
          document.getElementById('premium-section').style.display = 'none';
          document.getElementById('downloadBtn').disabled = true;
          document.getElementById('premium-msg').innerText = '';
        }

        // 1) Fetch your allTransactions data hereâ€¦
        // 2) Call filterTransactions() to render initial view
      });

      // ---- Your filter & render logic ----
      let allTransactions = []; // fill this from your API

      function filterTransactions() {
        const filter = document.getElementById('filterType').value;
        const today = new Date();
        const dayStart = new Date(today); dayStart.setHours(0,0,0,0);
        const weekStart = new Date(today);
        weekStart.setDate(today.getDate() - today.getDay());
        weekStart.setHours(0,0,0,0);

        const filtered = allTransactions.filter(tx => {
          const d = new Date(tx.date);
          if (filter === 'daily')  return d >= dayStart && d <= today;
          if (filter === 'weekly') return d >= weekStart && d <= today;
          if (filter === 'monthly')
            return d.getMonth() === today.getMonth() && d.getFullYear() === today.getFullYear();
          return true;
        });

        renderDayTable(filtered);
        renderYearlyReport(filtered);
        renderNotes(filtered);
      }

      function renderDayTable(data) {
        const tbody = document.getElementById('dayTable');
        tbody.innerHTML = '';
        let incomeSum = 0, expenseSum = 0;

        if (!data.length) {
          tbody.innerHTML = '<tr><td colspan="5" class="text-center">No data</td></tr>';
        } else {
          data.forEach(tx => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
              <td>${new Date(tx.date).toLocaleDateString()}</td>
              <td>${tx.description}</td>
              <td>${tx.category}</td>
              <td class="text-center">${tx.type==='income'? 'â‚¹'+tx.amount.toFixed(2) : 'â‚¹0.00'}</td>
              <td class="text-center">${tx.type==='expense'? 'â‚¹'+tx.amount.toFixed(2) : 'â‚¹0.00'}</td>
            `;
            tbody.appendChild(tr);
            tx.type==='income' ? incomeSum += tx.amount : expenseSum += tx.amount;
          });
        }

        // update totals row
        const foot = tbody.parentNode.querySelector('tfoot tr').children;
        foot[3].innerText = `â‚¹${incomeSum.toFixed(2)}`;
        foot[4].innerText = `â‚¹${expenseSum.toFixed(2)}`;
      }

      function renderYearlyReport(data) {
        // group by monthâ€¦
        const monthMap = {};
        data.forEach(tx => {
          const d = new Date(tx.date);
          const key = d.toLocaleString('default',{ month:'long', year:'numeric' });
          monthMap[key] = monthMap[key] || { income:0, expense:0 };
          monthMap[key][tx.type] += tx.amount;
        });
        const tbody = document.getElementById('yearlyReport');
        tbody.innerHTML = '';
        for (let m in monthMap) {
          const inc = monthMap[m].income, exp = monthMap[m].expense;
          const save = inc - exp;
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${m}</td>
            <td class="text-center">â‚¹${inc.toFixed(2)}</td>
            <td class="text-center">â‚¹${exp.toFixed(2)}</td>
            <td class="text-center">â‚¹${save.toFixed(2)}</td>
          `;
          tbody.appendChild(tr);
        }
        if (!Object.keys(monthMap).length) {
          tbody.innerHTML = '<tr><td colspan="4" class="text-center">No data</td></tr>';
        }
      }

      function renderNotes(data) {
        // if you have a notes field on each tx, adapt here
        const tbody = document.getElementById('notesTable');
        tbody.innerHTML = '';
        const notesOnly = data.filter(tx => tx.notes);
        if (!notesOnly.length) {
          tbody.innerHTML = '<tr><td colspan="2" class="text-center">No notes</td></tr>';
        } else {
          notesOnly.forEach(tx => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
              <td>${new Date(tx.date).toLocaleDateString()}</td>
              <td>${tx.notes}</td>
            `;
            tbody.appendChild(tr);
          });
        }
      }

      // ---- Download as CSV ----
      function downloadExpenses() {
        // Build CSV from filtered dayTableâ€¦
        // Trigger a blob downloadâ€¦
        // (you can also do JSON if you prefer)
      }
    </script>
  </body>
</html>
